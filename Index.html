<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Analisis Vectorial</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
	font-family: 'Segoe UI', sans-serif; 
	background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); 
	color: #fff; 
	margin: 0; 
	padding: 20px; 
	}
    h1 { 
	text-align: center;
	margin-bottom: 5px; 
	}
    .container { 
	display: flex;
	gap: 20px;
	flex-wrap: wrap; 
	justify-content: center; 
	}
    .panel { 
	background: rgba(255,255,255,0.1);
	padding: 20px; 
	border-radius: 15px; 
	flex: 1; 
	min-width: 350px; 
	max-width: 500px; 
	box-shadow: 0 0 15px rgba(0,0,0,0.4); 
	}
    select, input { 
	width: 100%;
	padding: 10px; 
	margin: 8px 0; 
	border-radius: 8px; 
	border: none; 
	}
    button { 
	width: 100%; 
	margin-top: 15px; 
	padding: 12px; 
	border: none; 
	border-radius: 12px; 
	font-weight: bold; 
	background: linear-gradient(45deg, #00c6ff, #0072ff); 
	color: white; 
	cursor: pointer; 
	transition: 0.3s; 
	}
    button:hover { 
	transform: scale(1.02); 
	}
    .result-item { 
	background: rgba(0,0,0,0.3); 
	padding: 12px; 
	margin-top: 8px; 
	border-radius: 8px; 
	border-left: 4px solid #00c6ff; 
	}
    .formula-box { 
	background: rgba(255,255,255,0.08);
	padding: 15px; 
	margin-top: 15px; 
	border-radius: 10px; 
	font-family: 'Courier New', monospace; font-size: 14px; 
	line-height: 1.5;
	}
    #graph { 
	width: 100%; 
	height: 450px; 
	border-radius: 10px; 
	margin-top: 10px; 
	}
    .highlight { 
	color: #4ade80; 
	font-weight: bold; 
	}
  </style>
</head>
<body>

<h1>Calculadora de Integrales Vectoriales</h1>
<p style="text-align:center">Proyecto: Aproximacion Numerica con Jacobianos</p>

<div class="container">
  <div class="panel">
    <h3>Configuracion</h3>
    
    <label>Seleccionar Funcion</label>
    <select id="funcId">
      <option value="f1">Potencial Cuadratico (Suma de cuadrados)</option>
      <option value="f2">Campo Lineal (Plano inclinado)</option>
      <option value="f3">Calculo de Masa Unitaria (Densidad constante)</option>
    </select>

    <label>Sistema de Coordenadas y Region</label>
    <select id="sistema">
      <option value="rect">Doble: Region Rectangular</option>
      <option value="disco">Doble: Region Circular (Disco)</option>
      <option value="caja">Triple: Region Cubica</option>
      <option value="esfera">Triple: Region Esferica</option>
      <option value="cilindro">Triple: Region Cilindrica</option>
    </select>

    <label>Particiones por eje (n)</label>
    <input type="number" id="n" value="0" min="0" max="100" placeholder="Ej: 30">

    <button onclick="ejecutar()">CALCULAR INTEGRAL</button>

    <div id="resultado"></div>
  </div>

  <div class="panel">
    <h3>Visualizacion de la Región</h3>
    <div id="graph"></div>
  </div>
</div>

<script>
// --- CATALOGO DE FUNCIONES ---
const funciones = {
    f1: (x, y, z = 0) => x*x + y*y + z*z,
    f2: (x, y, z = 0) => x + y + z,
    f3: (x, y, z = 0) => 1
};

// --- VALORES TEORICOS (Para f1: x²+y²+z²) ---
// Nota: En un proyecto real, esto se calcularía simbólicamente o con fórmulas fijas
function getExacto(sistema, funcId) {
    if (funcId !== 'f1') return null; // Solo daremos exacto para f1 en este ejemplo
    const exactos = {
        'rect': 8/3,      // Integral doble x²+y² en [-1,1]²
        'disco': Math.PI/2, 
        'caja': 8.0,      // Integral triple x²+y²+z² en caja [-1,1]³
        'esfera': (4/5) * Math.PI,
        'cilindro': 3 * Math.PI
    };
    return exactos[sistema];
}

function ejecutar() {
    const funcId = document.getElementById("funcId").value;
    const f = funciones[funcId];
    const sistema = document.getElementById("sistema").value;
    const n = parseInt(document.getElementById("n").value);
    
    let aprox = 0;
    let puntos = { x: [], y: [], z: [], c: [] };
    const d = 1/n;

    // --- LOGICA DE INTEGRACION ---
    if (sistema === "rect" || sistema === "disco") {
        const lim = (sistema === "rect") ? {r1: -1, r2: 1, t1: -1, t2: 1} : {r1: 0, r2: 1, t1: 0, t2: 2*Math.PI};
        const dr = (lim.r2 - lim.r1)/n;
        const dt = (lim.t2 - lim.t1)/n;

        for(let i=0; i<n; i++) {
            for(let j=0; j<n; j++) {
                const u = lim.r1 + (i + 0.5) * dr;
                const v = lim.t1 + (j + 0.5) * dt;
                let x, y, jacobiano;

                if (sistema === "rect") {
                    x = u; y = v; jacobiano = 1;
                } else {
                    x = u * Math.cos(v); y = u * Math.sin(v); jacobiano = u; // Jacobiano Polar
                }

                const val = f(x, y);
                aprox += val * jacobiano;
                if (i%2==0 && j%2==0) { puntos.x.push(x); puntos.y.push(y); puntos.z.push(val); puntos.c.push(val); }
            }
        }
        aprox *= (dr * dt);
    } 
    else {
        // TRIPLE
        let dr, dt, dp;
        if (sistema === "caja") { dr=2/n; dt=2/n; dp=2/n; }
        else if (sistema === "esfera") { dr=1/n; dt=2*Math.PI/n; dp=Math.PI/n; }
        else if (sistema === "cilindro") { dr=1/n; dt=2*Math.PI/n; dp=2/n; }

        for(let i=0; i<n; i++) {
            for(let j=0; j<n; j++) {
                for(let k=0; k<n; k++) {
                    const u = (sistema === "caja" ? -1 : 0) + (i+0.5)*dr;
                    const v = (j+0.5)*dt;
                    const w = (sistema === "cilindro" ? -1 : 0) + (k+0.5)*dp;
                    let x, y, z, J;

                    if(sistema === "caja") { x=u; y=v-1; z=w; J=1; }
                    else if(sistema === "esfera") {
                        x = u*Math.sin(w)*Math.cos(v); y=u*Math.sin(w)*Math.sin(v); z=u*Math.cos(w);
                        J = u*u*Math.sin(w); // Jacobiano Esferico
                    }
                    else {
                        x = u*Math.cos(v); y=u*Math.sin(v); z=w; J=u; // Jacobiano Cilindrico
                    }
                    
                    const val = f(x, y, z);
                    aprox += val * J;
                    if(i%4==0 && j%4==0 && k%4==0) { puntos.x.push(x); puntos.y.push(y); puntos.z.push(z); puntos.c.push(val); }
                }
            }
        }
        aprox *= (dr * dt * dp);
    }

    const exacto = getExacto(sistema, funcId);
    mostrarResultados(aprox, exacto, sistema);
    plotRegion(puntos, sistema.includes('rect') || sistema.includes('disco') ? '2d' : '3d');
}

function mostrarResultados(aprox, exacto, sistema) {
    let errorHTML = "";
    if (exacto) {
        const error = Math.abs(aprox - exacto) / exacto;
        errorHTML = `<div class="result-item">Valor Teorico: <span class="highlight">${exacto.toFixed(4)}</span></div>
                     <div class="result-item">Error Relativo: <span class="highlight">${(error * 100).toFixed(4)}%</span></div>`;
    }

    document.getElementById("resultado").innerHTML = `
        <div class="result-item">Aproximacion Numerica: <span class="highlight">${aprox.toFixed(6)}</span></div>
        ${errorHTML}
        <div class="formula-box">
            <strong>Diferencial utilizado:</strong><br>
            ${getFormula(sistema)}
        </div>
    `;
}

function getFormula(s) {
    if(s === "rect") return "dA = dx dy";
    if(s === "disco") return "dA = r dr dθ";
    if(s === "esfera") return "dV = ρ² sin(φ) dρ dθ dφ";
    if(s === "cilindro") return "dV = r dz dr dθ";
    return "dV = dx dy dz";
}

function plotRegion(p, mode) {
    const trace = {
        x: p.x, y: p.y, z: p.z,
        mode: 'markers',
        marker: { size: 3, color: p.c, colorscale: 'Viridis', opacity: 0.8 },
        type: mode === '2d' ? 'scatter3d' : 'scatter3d'
    };
    const layout = { margin: {l:0,r:0,b:0,t:0}, paper_bgcolor: "rgba(0,0,0,0)", scene: { xaxis: {color: "#fff"}, yaxis: {color: "#fff"}, zaxis: {color: "#fff"} } };
    Plotly.newPlot("graph", [trace], layout);
}

// Inicializar
ejecutar();
</script>
</body>
</html>

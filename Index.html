<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Analisis Vectorial Pro</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%);
      color: #e0e0e0;
      margin: 0;
      padding: 40px 20px;
    }
    h1 { text-align: center; font-weight: 300; letter-spacing: 2px; margin-bottom: 10px; color: #fff; }
    p.subtitle { text-align: center; opacity: 0.7; margin-bottom: 40px; }
    
    .container { display: flex; gap: 30px; flex-wrap: wrap; justify-content: center; max-width: 1200px; margin: 0 auto; }
    
    .panel {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      flex: 1;
      min-width: 400px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.1);
    }

    h3 { margin-top: 0; color: #00c6ff; font-weight: 400; display: flex; align-items: center; gap: 10px; }
    
    label { display: block; margin-top: 20px; font-size: 0.85rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.8; }
    
    select, input {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      color: #fff;
      box-sizing: border-box;
      outline: none;
    }

    button {
      width: 100%;
      margin-top: 25px;
      padding: 15px;
      border: none;
      border-radius: 12px;
      font-weight: bold;
      text-transform: uppercase;
      background: linear-gradient(45deg, #0072ff, #00c6ff);
      color: white;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0, 114, 255, 0.3);
      transition: all 0.3s ease;
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 114, 255, 0.5); }

    .result-item {
      background: rgba(255,255,255,0.03);
      padding: 15px;
      margin-top: 15px;
      border-radius: 12px;
      border-left: 5px solid #00c6ff;
    }
    
    .formula-box {
      font-family: 'Consolas', monospace;
      font-size: 0.9rem;
      color: #4ade80;
      margin-top: 20px;
      background: rgba(0,0,0,0.2);
      padding: 15px;
      border-radius: 10px;
    }

    #graph { width: 100%; height: 500px; }
    .highlight { color: #4ade80; font-weight: 600; font-size: 1.1rem; }
  </style>
</head>
<body>

<h1>Calculadora de Integrales Vectoriales</h1>
<p class="subtitle">Aproximacion Numerica vs Valor Teorico (Visualizacion de Campos)</p>

<div class="container">
  <div class="panel">
    <h3> Configuracion</h3>
    
    <label>Funcion f(x, y, z)</label>
    <select id="funcId">
      <option value="f1">Potencial Cuadratico (x² + y² + z²)</option>
      <option value="f2">Campo Lineal (x + y + z)</option>
      <option value="f3">Masa/Volumen Unitario (1)</option>
    </select>

    <label>Region de Integracion</label>
    <select id="sistema">
      <option value="rect">Doble: Region Rectangular</option>
      <option value="disco">Doble: Region Circular (Disco)</option>
      <option value="caja">Triple: Region Cubica</option>
      <option value="esfera">Triple: Region Esferica</option>
      <option value="cilindro">Triple: Region Cilindrica</option>
    </select>

    <label>Resolucion de Malla (Particiones)</label>
    <input type="number" id="n" value="25" min="5" max="50">

    <button onclick="ejecutar()">Generar e Integrar</button>

    <div id="resultado"></div>
  </div>

  <div class="panel">
    <h3>Visualizacion de Campo Vectorial</h3>
    <div id="graph"></div>
  </div>
</div>

<script>
const funciones = {
    f1: (x, y, z = 0) => x*x + y*y + z*z,
    f2: (x, y, z = 0) => x + y + z,
    f3: (x, y, z = 0) => 1
};

function getExacto(sistema, funcId) {
    if (funcId !== 'f1') return null;
    const exactos = {
        'rect': 8/3, 'disco': Math.PI/2, 'caja': 8.0, 'esfera': (4/5) * Math.PI, 'cilindro': 3 * Math.PI
    };
    return exactos[sistema];
}

function ejecutar() {
    const funcId = document.getElementById("funcId").value;
    const f = funciones[funcId];
    const sistema = document.getElementById("sistema").value;
    const n = parseInt(document.getElementById("n").value);
    
    let aprox = 0;
    // Datos para los vectores (Conos)
    let vData = { x: [], y: [], z: [], u: [], v: [], w: [] };
    const step = Math.max(1, Math.floor(n/10)); // Densidad de flechas para no saturar el grafico

    // --- LÓGICA DE INTEGRACION ---
    if (sistema === "rect" || sistema === "disco") {
        const dr = (sistema === "rect" ? 2 : 1) / n;
        const dt = (sistema === "rect" ? 2 : 2*Math.PI) / n;

        for(let i=0; i<n; i++) {
            for(let j=0; j<n; j++) {
                const r = (sistema === "rect" ? -1 : 0) + (i + 0.5) * dr;
                const t = (sistema === "rect" ? -1 : 0) + (j + 0.5) * dt;
                let x, y, J;

                if (sistema === "rect") { x = r; y = t; J = 1; }
                else { x = r * Math.cos(t); y = r * Math.sin(t); J = r; }

                const val = f(x, y);
                aprox += val * J;

                // Guardar datos para flechas (muestreo ralo para estetica)
                if (i % step === 0 && j % step === 0) {
                    vData.x.push(x); vData.y.push(y); vData.z.push(0);
                    vData.u.push(x * 0.2); vData.v.push(y * 0.2); vData.w.push(val * 0.2);
                }
            }
        }
        aprox *= (dr * dt);
    } else {
        let dr, dt, dp;
        if (sistema === "caja") { dr=2/n; dt=2/n; dp=2/n; }
        else if (sistema === "esfera") { dr=1/n; dt=2*Math.PI/n; dp=Math.PI/n; }
        else if (sistema === "cilindro") { dr=1/n; dt=2*Math.PI/n; dp=2/n; }

        for(let i=0; i<n; i++) {
            for(let j=0; j<n; j++) {
                for(let k=0; k<n; k++) {
                    const r = (sistema === "caja" ? -1 : 0) + (i+0.5)*dr;
                    const t = (j+0.5)*dt;
                    const p = (sistema === "cilindro" ? -1 : 0) + (k+0.5)*dp;
                    let x, y, z, J;

                    if(sistema === "caja") { x=r; y=t-1; z=p; J=1; }
                    else if(sistema === "esfera") {
                        x = r*Math.sin(p)*Math.cos(t); y=r*Math.sin(p)*Math.sin(t); z=r*Math.cos(p);
                        J = r*r*Math.sin(p);
                    }
                    else { x = r*Math.cos(t); y=r*Math.sin(t); z=p; J=r; }
                    
                    const val = f(x, y, z);
                    aprox += val * J;

                    if(i % (step*2) === 0 && j % (step*2) === 0 && k % (step*2) === 0) {
                        vData.x.push(x); vData.y.push(y); vData.z.push(z);
                        vData.u.push(x*0.3); vData.v.push(y*0.3); vData.w.push(z*0.3);
                    }
                }
            }
        }
        aprox *= (dr * dt * dp);
    }

    mostrarResultados(aprox, getExacto(sistema, funcId), sistema);
    plotVectorField(vData);
}

function mostrarResultados(aprox, exacto, sistema) {
    let errorHTML = "";
    if (exacto) {
        const error = Math.abs(aprox - exacto) / exacto;
        errorHTML = `<div class="result-item">Valor Teorico: <span class="highlight">${exacto.toFixed(4)}</span></div>
                     <div class="result-item">Error Relativo: <span class="highlight">${(error * 100).toFixed(4)}%</span></div>`;
    }
    document.getElementById("resultado").innerHTML = `
        <div class="result-item">Aproximacion Numerica: <span class="highlight">${aprox.toFixed(6)}</span></div>
        ${errorHTML}
        <div class="formula-box"><strong>Diferencial:</strong> ${getFormula(sistema)}</div>`;
}

function getFormula(s) {
    const f = { rect: "dx dy", disco: "r dr dθ", esfera: "ρ² sin(φ) dρ dθ dφ", cilindro: "r dz dr dθ", caja: "dx dy dz" };
    return "dV = " + f[s];
}

function plotVectorField(d) {
    const trace = {
        type: 'cone',
        x: d.x, y: d.y, z: d.z,
        u: d.u, v: d.v, w: d.w,
        sizemode: 'scaled',
        sizeref: 1.5,
        colorscale: 'Viridis',
        showscale: false,
        hoverinfo: 'x+y+z'
    };

    const layout = {
        scene: {
            xaxis: { title: 'X', gridcolor: '#444', zerolinecolor: '#fff' },
            yaxis: { title: 'Y', gridcolor: '#444', zerolinecolor: '#fff' },
            zaxis: { title: 'Z', gridcolor: '#444', zerolinecolor: '#fff' },
            bgcolor: 'rgba(0,0,0,0)'
        },
        margin: { l: 0, r: 0, b: 0, t: 0 },
        paper_bgcolor: 'rgba(0,0,0,0)'
    };

    Plotly.newPlot("graph", [trace], layout);
}

// Inicializar con un calculo vacío
ejecutar();
</script>
</body>
</html>
